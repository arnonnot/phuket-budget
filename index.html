<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Sarabun', sans-serif; }
        .gradient-header { background: linear-gradient(90deg, #7DD3FC, #3B82F6); }
        .hover-row:hover { background-color: #EFF6FF !important; transform: translateY(-1px); transition: all 0.2s ease; }
        .number-cell { font-variant-numeric: tabular-nums; }
        .chart-bar { transition: width 0.8s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 0.5s ease-out; }
        
        /* Mobile responsive styles */
        @media (max-width: 768px) {
            .mobile-text { font-size: 0.75rem; }
            .mobile-padding { padding: 0.5rem; }
            .mobile-header { font-size: 1.25rem; }
            .sticky-cell { position: sticky; left: 0; z-index: 5; min-width: 200px; }
            .sticky-cell-gray { background-color: #f3f4f6; }
            .sticky-cell-white { background-color: white; }
            .sticky-cell-blue { background-color: #dbeafe; }
            .sticky-cell-red { background-color: #fecaca; }
        }
    </style>
</head>
<body class="bg-blue-50 p-2 md:p-6">
    <div class="max-w-7xl mx-auto">
        <div class="bg-white rounded-lg shadow-lg p-3 md:p-6 mb-3 md:mb-6 fade-in">
            <h1 class="text-xl md:text-3xl font-bold text-gray-800 mb-2 text-center mobile-header">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö - ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ ‡∏Ç‡∏≠‡∏á‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏™‡πà‡∏ß‡∏ô‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï</h1>
            <p class="text-sm md:text-base text-gray-600 text-center">‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ‡∏û.‡∏®. 2567 - 2569</p>
            
            <div class="mt-4 flex gap-2 flex-wrap justify-center">
                <button id="tableView" class="px-3 py-2 md:px-4 md:py-2 bg-blue-400 text-white rounded-lg hover:bg-blue-500 transition-colors text-sm shadow-md">
                    üìä ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
                <button id="chartView" class="px-3 py-2 md:px-4 md:py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors text-sm shadow-md">
                    üìà ‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö
                </button>
                <button id="subsidyView" class="px-3 py-2 md:px-4 md:py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors text-sm shadow-md">
                    üí∞ ‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô
                </button>
            </div>
        </div>

        <div id="tableContainer" class="space-y-4 fade-in">
            <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                <div class="p-3 md:p-4">
                    <h2 class="text-lg md:text-xl font-bold text-gray-800">1. ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</h2>
                    
                    <div class="mt-4 border-b border-gray-200">
                        <div class="flex flex-wrap gap-1">
                            <button id="revenueOverview" class="px-3 py-2 text-sm font-medium text-blue-600 bg-blue-50 border-b-2 border-blue-600 hover:bg-blue-100 transition-colors">
                                üìä ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°
                            </button>
                            <button id="revenue2567" class="px-3 py-2 text-sm font-medium text-gray-600 hover:text-blue-600 hover:bg-gray-50 border-b-2 border-transparent hover:border-blue-300 transition-colors">
                                üìà ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏õ‡∏µ 2567
                            </button>
                            <button id="revenue2568" class="px-3 py-2 text-sm font-medium text-gray-600 hover:text-blue-600 hover:bg-gray-50 border-b-2 border-transparent hover:border-blue-300 transition-colors">
                                üìà ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏õ‡∏µ 2568
                            </button>
                        </div>
                    </div>
                </div>
                
                <div id="revenueOverviewContent" class="revenue-content">
                    <div class="overflow-x-auto">
                        <table class="w-full border-collapse min-w-[600px]">
                            <thead class="gradient-header text-white">
                                <tr>
                                    <th class="p-2 md:p-4 text-left font-semibold text-xs md:text-sm sticky left-0 bg-blue-600 z-10 min-w-[200px] md:min-w-0 md:static md:bg-transparent">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                                    <th class="p-2 md:p-4 text-center font-semibold text-xs md:text-sm min-w-[100px]">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏à‡∏£‡∏¥‡∏á<br>‡∏õ‡∏µ 2567</th>
                                    <th class="p-2 md:p-4 text-center font-semibold text-xs md:text-sm min-w-[100px]">‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£<br>‡∏õ‡∏µ 2568</th>
                                    <th class="p-2 md:p-4 text-center font-semibold text-xs md:text-sm min-w-[100px]">‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£<br>‡∏õ‡∏µ 2569</th>
                                    <th class="p-2 md:p-4 text-center font-semibold text-xs md:text-sm min-w-[80px]">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á (%)<br>(2569 vs 2568)</th>
                                </tr>
                            </thead>
                            <tbody id="revenueTableBody">
                                </tbody>
                        </table>
                    </div>
                </div>
                
                <div id="revenue2567Content" class="revenue-content hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full border-collapse min-w-[800px]">
                            <thead class="gradient-header text-white">
                                <tr>
                                    <th class="p-2 md:p-4 text-left font-semibold text-xs md:text-sm sticky left-0 bg-blue-600 z-10 min-w-[150px] md:min-w-0 md:static md:bg-transparent">‡∏´‡∏°‡∏ß‡∏î</th>
                                    <th class="p-2 md:p-4 text-left font-semibold text-xs md:text-sm min-w-[200px]">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                                    <th class="p-2 md:p-4 text-center font-semibold text-xs md:text-sm min-w-[120px]">‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£</th>
                                    <th class="p-2 md:p-4 text-center font-semibold text-xs md:text-sm min-w-[120px]">‡∏£‡∏±‡∏ö‡∏à‡∏£‡∏¥‡∏á</th>
                                    <th class="p-2 md:p-4 text-center font-semibold text-xs md:text-sm min-w-[150px]">‡∏£‡∏±‡∏ö‡∏à‡∏£‡∏¥‡∏á‡πÄ‡∏Å‡∏¥‡∏ô/‡∏Ç‡∏≤‡∏î<br>‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£</th>
                                </tr>
                            </thead>
                            <tbody id="revenue2567TableBody">
                                </tbody>
                        </table>
                    </div>
                </div>
                
                <div id="revenue2568Content" class="revenue-content hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full border-collapse min-w-[800px]">
                            <thead class="gradient-header text-white">
                                <tr>
                                    <th class="p-2 md:p-4 text-left font-semibold text-xs md:text-sm sticky left-0 bg-blue-600 z-10 min-w-[150px] md:min-w-0 md:static md:bg-transparent">‡∏´‡∏°‡∏ß‡∏î</th>
                                    <th class="p-2 md:p-4 text-left font-semibold text-xs md:text-sm min-w-[200px]">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                                    <th class="p-2 md:p-4 text-center font-semibold text-xs md:text-sm min-w-[120px]">‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£</th>
                                    <th class="p-2 md:p-4 text-center font-semibold text-xs md:text-sm min-w-[120px]">‡∏£‡∏±‡∏ö‡∏à‡∏£‡∏¥‡∏á</th>
                                    <th class="p-2 md:p-4 text-center font-semibold text-xs md:text-sm min-w-[150px]">‡∏£‡∏±‡∏ö‡∏à‡∏£‡∏¥‡∏á‡πÄ‡∏Å‡∏¥‡∏ô/‡∏Ç‡∏≤‡∏î<br>‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£</th>
                                </tr>
                            </thead>
                            <tbody id="revenue2568TableBody">
                                </tbody>
                        </table>
                    </div>
                    <div class="p-4 text-center text-sm text-gray-600 bg-gray-50">
                        <p>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏ì ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 25 ‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏° 2568</p>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                <div class="p-3 md:p-4">
                    <h2 class="text-lg md:text-xl font-bold text-gray-800">2. ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h2>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse min-w-[600px]">
                        <thead class="bg-blue-500 text-white">
                            <tr>
                                <th class="p-2 md:p-4 text-left font-semibold text-xs md:text-sm sticky left-0 bg-blue-500 z-10 min-w-[200px] md:min-w-0 md:static md:bg-transparent">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                                <th class="p-2 md:p-4 text-center font-semibold text-xs md:text-sm min-w-[100px]">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏à‡∏£‡∏¥‡∏á<br>‡∏õ‡∏µ 2567</th>
                                <th class="p-2 md:p-4 text-center font-semibold text-xs md:text-sm min-w-[100px]">‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£<br>‡∏õ‡∏µ 2568</th>
                                <th class="p-2 md:p-4 text-center font-semibold text-xs md:text-sm min-w-[100px]">‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£<br>‡∏õ‡∏µ 2569</th>
                                <th class="p-2 md:p-4 text-center font-semibold text-xs md:text-sm min-w-[80px]">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á (%)<br>(2569 vs 2568)</th>
                            </tr>
                        </thead>
                        <tbody id="expenseTableBody">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="chartContainer" class="bg-white rounded-lg shadow-lg p-3 md:p-6 hidden">
            <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-4 md:mb-6">‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö</h2>
            <div id="chartContent">
                </div>
        </div>

        <div id="subsidyContainer" class="bg-white rounded-lg shadow-lg overflow-hidden hidden">
            <div class="p-3 md:p-4">
                <h2 class="text-lg md:text-xl font-bold text-gray-800">‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô</h2>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full border-collapse min-w-[1200px]">
                    <thead class="gradient-header text-white">
                        <tr>
                            <th class="p-2 md:p-3 text-left font-semibold text-xs md:text-sm sticky left-0 bg-blue-600 z-10 min-w-[250px] md:min-w-0 md:static md:bg-transparent">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                            <th class="p-2 md:p-3 text-center font-semibold text-xs md:text-sm min-w-[100px]">‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏ï‡∏≤‡∏°<br>‡∏û.‡∏£.‡∏ö. 2567</th>
                            <th class="p-2 md:p-3 text-center font-semibold text-xs md:text-sm min-w-[100px]">‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢<br>2567</th>
                            <th class="p-2 md:p-3 text-center font-semibold text-xs md:text-sm min-w-[80px]">‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢<br>2567</th>
                            <th class="p-2 md:p-3 text-center font-semibold text-xs md:text-sm min-w-[80px]">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠<br>2567</th>
                            <th class="p-2 md:p-3 text-center font-semibold text-xs md:text-sm min-w-[100px]">‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏ï‡∏≤‡∏°<br>‡∏û.‡∏£.‡∏ö. 2568 (1)</th>
                            <th class="p-2 md:p-3 text-center font-semibold text-xs md:text-sm min-w-[100px]">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢<br>2568 (2)</th>
                            <th class="p-2 md:p-3 text-center font-semibold text-xs md:text-sm min-w-[100px]">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢<br>PO 2568 (3)</th>
                            <th class="p-2 md:p-3 text-center font-semibold text-xs md:text-sm min-w-[80px]">‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢<br>2568</th>
                            <th class="p-2 md:p-3 text-center font-semibold text-xs md:text-sm min-w-[100px]">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 2568<br>(1) - (3)</th>
                            <th class="p-2 md:p-3 text-center font-semibold text-xs md:text-sm min-w-[100px]">‡∏û.‡∏£.‡∏ö.<br>2569</th>
                            <th class="p-2 md:p-3 text-center font-semibold text-xs md:text-sm min-w-[80px]">‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏•‡∏î<br>2569</th>
                            <th class="p-2 md:p-3 text-center font-semibold text-xs md:text-sm min-w-[80px]">‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞<br>2569</th>
                        </tr>
                    </thead>
                    <tbody id="subsidyTableBody">
                        </tbody>
                </table>
            </div>
            
            <div class="p-3 md:p-6">
                <h3 class="text-lg md:text-xl font-semibold mb-4">‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô</h3>
                <div id="subsidyChartContent">
                    </div>
            </div>
        </div>
    </div>

    <script>
        // Performance optimizations
        const BATCH_SIZE = 10;
        let isLoading = false;
        let loadedViews = new Set();
        
        // Pre-computed formatters for better performance
        const numberFormatter = new Intl.NumberFormat('th-TH', { 
            minimumFractionDigits: 2, 
            maximumFractionDigits: 2 
        });

        // Revenue 2568 detailed data
        let revenue2568Data = [
            {
                category: "‡∏´‡∏°‡∏ß‡∏î‡∏†‡∏≤‡∏©‡∏µ‡∏≠‡∏≤‡∏Å‡∏£",
                items: [
                    { type: "‡∏†‡∏≤‡∏©‡∏µ‡∏ö‡∏≥‡∏£‡∏∏‡∏á ‡∏≠‡∏ö‡∏à. ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡∏¢‡∏≤‡∏™‡∏π‡∏ö", estimated: 40000000.00, actual: 39499839.37, difference: -500160.63 },
                    { type: "‡∏†‡∏≤‡∏©‡∏µ‡∏ö‡∏≥‡∏£‡∏∏‡∏á ‡∏≠‡∏ö‡∏à. ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô/‡∏Å‡πä‡∏≤‡∏ã", estimated: 17000000.00, actual: 16477655.28, difference: -522344.72 }
                ],
                total: { estimated: 57000000.00, actual: 55977494.65, difference: -1022505.35 }
            },
            {
                category: "‡∏´‡∏°‡∏ß‡∏î‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏° ‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö ‡πÅ‡∏•‡∏∞‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï",
                items: [
                    { type: "‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á ‡∏≠‡∏ö‡∏à. ‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°", estimated: 320000000.00, actual: 327505805.64, difference: 7505805.64 },
                    { type: "‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏†‡∏≤‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô", estimated: 100000.00, actual: 206000.00, difference: 106000.00 },
                    { type: "‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏≠‡∏∑‡πà‡∏ô ‡πÜ", estimated: 20000.00, actual: 41100.00, difference: 21100.00 },
                    { type: "‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ú‡∏¥‡∏î‡∏™‡∏±‡∏ç‡∏ç‡∏≤", estimated: 10000000.00, actual: 20811945.97, difference: 10811945.97 },
                    { type: "‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö‡∏≠‡∏∑‡πà‡∏ô ‡πÜ", estimated: 1000000.00, actual: 446505.00, difference: -553495.00 }
                ],
                total: { estimated: 331120000.00, actual: 349011356.61, difference: 17891356.61 }
            },
            {
                category: "‡∏´‡∏°‡∏ß‡∏î‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô",
                items: [
                    { type: "‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô", estimated: 20000000.00, actual: 17886670.63, difference: -2113329.37 },
                    { type: "‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£", estimated: 76597400.00, actual: 53165083.75, difference: -23432316.25 },
                    { type: "‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢", estimated: 25000000.00, actual: 34463342.93, difference: 9463342.93 },
                    { type: "‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î", estimated: 8000000.00, actual: 3793182.83, difference: -4206817.17 },
                    { type: "‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏≠‡∏∑‡πà‡∏ô ‡πÜ", estimated: 3500000.00, actual: 1649685.00, difference: -1850315.00 }
                ],
                total: { estimated: 133097400.00, actual: 110957965.14, difference: -22139434.86 }
            },
            {
                category: "‡∏´‡∏°‡∏ß‡∏î‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏ö‡πá‡∏î‡πÄ‡∏ï‡∏•‡πá‡∏î",
                items: [
                    { type: "‡∏Ñ‡πà‡∏≤‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢‡πÄ‡∏®‡∏©‡∏Ç‡∏≠‡∏á", estimated: 50000.00, actual: 62840.00, difference: 12840.00 },
                    { type: "‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏≠‡∏∏‡∏ó‡∏¥‡∏®‡πÉ‡∏´‡πâ", estimated: 10000.00, actual: 8062.80, difference: -1937.20 },
                    { type: "‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏ô‡∏≤‡πÅ‡∏•‡∏∞‡∏ñ‡πà‡∏≤‡∏¢‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£", estimated: 1000.00, actual: 4384.00, difference: 3384.00 },
                    { type: "‡∏Ñ‡πà‡∏≤‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏î", estimated: 10000.00, actual: 8900.00, difference: -1100.00 },
                    { type: "‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏ö‡πá‡∏î‡πÄ‡∏ï‡∏•‡πá‡∏î‡∏≠‡∏∑‡πà‡∏ô ‡πÜ", estimated: 100000.00, actual: 4445093.96, difference: 4345093.96 }
                ],
                total: { estimated: 171000.00, actual: 4529280.76, difference: 4358280.76 }
            },
            {
                category: "‡∏´‡∏°‡∏ß‡∏î‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏ô",
                items: [
                    { type: "‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≤‡∏¢‡∏ó‡∏≠‡∏î‡∏ï‡∏•‡∏≤‡∏î‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô", estimated: 300000.00, actual: 0.00, difference: -300000.00 }
                ],
                total: { estimated: 300000.00, actual: 0.00, difference: -300000.00 }
            },
            {
                category: "‡∏´‡∏°‡∏ß‡∏î‡∏†‡∏≤‡∏©‡∏µ‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£",
                items: [
                    { type: "‡∏†‡∏≤‡∏©‡∏µ‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå", estimated: 375000000.00, actual: 284546474.60, difference: -90453525.40 },
                    { type: "‡∏†‡∏≤‡∏©‡∏µ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏≤‡∏° ‡∏û.‡∏£.‡∏ö. ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÅ‡∏ú‡∏ô‡∏Ø", estimated: 120500000.00, actual: 97573781.39, difference: -22926218.61 },
                    { type: "‡∏†‡∏≤‡∏©‡∏µ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏≤‡∏° ‡∏û.‡∏£.‡∏ö. ‡∏≠‡∏ö‡∏à.‡∏Ø ‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ 5", estimated: 454500000.00, actual: 582508819.30, difference: 128008819.30 }
                ],
                total: { estimated: 950000000.00, actual: 964629075.29, difference: 14629075.29 }
            },
            {
                category: "‡∏´‡∏°‡∏ß‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô",
                items: [
                    { type: "‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ", estimated: 255430100.00, actual: 256710500.00, difference: 1280400.00 }
                ],
                total: { estimated: 255430100.00, actual: 256710500.00, difference: 1280400.00 }
            }
        ];

        // Revenue 2567 detailed data
        let revenue2567Data = [
            {
                category: "‡∏´‡∏°‡∏ß‡∏î‡∏†‡∏≤‡∏©‡∏µ‡∏≠‡∏≤‡∏Å‡∏£",
                items: [
                    { type: "‡∏†‡∏≤‡∏©‡∏µ‡∏ö‡∏≥‡∏£‡∏∏‡∏á ‡∏≠‡∏ö‡∏à. ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡∏¢‡∏≤‡∏™‡∏π‡∏ö", estimated: 36000000.00, actual: 36894527.82, difference: 894527.82 },
                    { type: "‡∏†‡∏≤‡∏©‡∏µ‡∏ö‡∏≥‡∏£‡∏∏‡∏á ‡∏≠‡∏ö‡∏à. ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô/‡∏Å‡πä‡∏≤‡∏ã", estimated: 20000000.00, actual: 17492212.54, difference: -2507787.46 }
                ],
                total: { estimated: 56000000.00, actual: 54386740.36, difference: -1613259.64 }
            },
            {
                category: "‡∏´‡∏°‡∏ß‡∏î‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏° ‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö ‡πÅ‡∏•‡∏∞‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï",
                items: [
                    { type: "‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á ‡∏≠‡∏ö‡∏à. ‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°", estimated: 300000000.00, actual: 315211985.44, difference: 15211985.44 },
                    { type: "‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏†‡∏≤‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô", estimated: 0.00, actual: 4000.00, difference: 4000.00 },
                    { type: "‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏≠‡∏∑‡πà‡∏ô ‡πÜ", estimated: 0.00, actual: 44600.00, difference: 44600.00 },
                    { type: "‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ú‡∏¥‡∏î‡∏™‡∏±‡∏ç‡∏ç‡∏≤", estimated: 4200000.00, actual: 25556230.27, difference: 21356230.27 },
                    { type: "‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö‡∏≠‡∏∑‡πà‡∏ô ‡πÜ", estimated: 758000.00, actual: 808420.00, difference: 50420.00 }
                ],
                total: { estimated: 304958000.00, actual: 341625235.71, difference: 36667235.71 }
            },
            {
                category: "‡∏´‡∏°‡∏ß‡∏î‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô",
                items: [
                    { type: "‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô", estimated: 16000000.00, actual: 18277318.30, difference: 2277318.30 },
                    { type: "‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£", estimated: 60000000.00, actual: 57840514.50, difference: -2159485.50 },
                    { type: "‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢", estimated: 15000000.00, actual: 31968432.39, difference: 16968432.39 },
                    { type: "‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î", estimated: 500000.00, actual: 12966439.35, difference: 12466439.35 },
                    { type: "‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏≠‡∏∑‡πà‡∏ô ‡πÜ", estimated: 2500000.00, actual: 2334705.00, difference: -165295.00 }
                ],
                total: { estimated: 94000000.00, actual: 123387409.54, difference: 29387409.54 }
            },
            {
                category: "‡∏´‡∏°‡∏ß‡∏î‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏ö‡πá‡∏î‡πÄ‡∏ï‡∏•‡πá‡∏î",
                items: [
                    { type: "‡∏Ñ‡πà‡∏≤‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢‡πÄ‡∏®‡∏©‡∏Ç‡∏≠‡∏á", estimated: 0.00, actual: 34570.00, difference: 34570.00 },
                    { type: "‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏≠‡∏∏‡∏ó‡∏¥‡∏®‡πÉ‡∏´‡πâ", estimated: 0.00, actual: 2761.40, difference: 2761.40 },
                    { type: "‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏ô‡∏≤‡πÅ‡∏•‡∏∞‡∏ñ‡πà‡∏≤‡∏¢‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£", estimated: 1000.00, actual: 393.00, difference: -607.00 },
                    { type: "‡∏Ñ‡πà‡∏≤‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏î", estimated: 10000.00, actual: 7600.00, difference: -2400.00 },
                    { type: "‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏ö‡πá‡∏î‡πÄ‡∏ï‡∏•‡πá‡∏î‡∏≠‡∏∑‡πà‡∏ô ‡πÜ", estimated: 650000.00, actual: 847363.00, difference: 197363.00 }
                ],
                total: { estimated: 661000.00, actual: 892687.40, difference: 231687.40 }
            },
            {
                category: "‡∏´‡∏°‡∏ß‡∏î‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏ô",
                items: [
                    { type: "‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≤‡∏¢‡∏ó‡∏≠‡∏î‡∏ï‡∏•‡∏≤‡∏î‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô", estimated: 300000.00, actual: 679300.00, difference: 379300.00 }
                ],
                total: { estimated: 300000.00, actual: 679300.00, difference: 379300.00 }
            },
            {
                category: "‡∏´‡∏°‡∏ß‡∏î‡∏†‡∏≤‡∏©‡∏µ‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£",
                items: [
                    { type: "‡∏†‡∏≤‡∏©‡∏µ‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå", estimated: 350000000.00, actual: 326271107.67, difference: -23728892.33 },
                    { type: "‡∏†‡∏≤‡∏©‡∏µ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏≤‡∏° ‡∏û.‡∏£.‡∏ö. ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÅ‡∏ú‡∏ô‡∏Ø", estimated: 120500000.00, actual: 111089405.64, difference: -9410594.36 },
                    { type: "‡∏†‡∏≤‡∏©‡∏µ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏≤‡∏° ‡∏û.‡∏£.‡∏ö. ‡∏≠‡∏ö‡∏à.‡∏Ø ‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ 5", estimated: 350000000.00, actual: 505663908.85, difference: 155663908.85 }
                ],
                total: { estimated: 820500000.00, actual: 943024422.16, difference: 122524422.16 }
            },
            {
                category: "‡∏´‡∏°‡∏ß‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô",
                items: [
                    { type: "‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ", estimated: 193581000.00, actual: 204458795.00, difference: 10877795.00 }
                ],
                total: { estimated: 193581000.00, actual: 204458795.00, difference: 10877795.00 }
            }
        ];

        // Optimized data structure with pre-computed values
        let budgetData = {
            revenue: {
                title: "1. ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö",
                selfRevenue: {
                    title: "‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏≠‡∏á",
                    items: [
                        { name: "‡∏´‡∏°‡∏ß‡∏î‡∏†‡∏≤‡∏©‡∏µ‡∏≠‡∏≤‡∏Å‡∏£", y2567: 54386740.36, y2568: 57000000.00, y2569: 57000000.00, change: 0.0, changeColor: 'text-gray-600', changeIcon: '‚û°Ô∏è' },
                        { name: "‡∏´‡∏°‡∏ß‡∏î‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏° ‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö ‡πÅ‡∏•‡∏∞‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï", y2567: 341625235.71, y2568: 331120000.00, y2569: 381070000.00, change: 15.1, changeColor: 'text-green-600', changeIcon: '‚ÜóÔ∏è' },
                        { name: "‡∏´‡∏°‡∏ß‡∏î‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô", y2567: 123387409.54, y2568: 133097400.00, y2569: 141500000.00, change: 6.3, changeColor: 'text-green-600', changeIcon: '‚ÜóÔ∏è' },
                        { name: "‡∏´‡∏°‡∏ß‡∏î‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏ö‡πá‡∏î‡πÄ‡∏ï‡∏•‡πá‡∏î", y2567: 892687.40, y2568: 171000.00, y2569: 675000.00, change: 294.7, changeColor: 'text-green-600', changeIcon: '‚ÜóÔ∏è' },
                        { name: "‡∏´‡∏°‡∏ß‡∏î‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏ô", y2567: 679300.00, y2568: 300000.00, y2569: 300000.00, change: 0.0, changeColor: 'text-gray-600', changeIcon: '‚û°Ô∏è' }
                    ],
                    total: { y2567: 520971373.01, y2568: 521688400.00, y2569: 580545000.00, change: 11.3, changeColor: 'text-green-600', changeIcon: '‚ÜóÔ∏è' }
                },
                governmentAllocation: {
                    title: "‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ê‡∏ö‡∏≤‡∏•‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£‡πÉ‡∏´‡πâ‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô",
                    items: [
                        { name: "‡∏´‡∏°‡∏ß‡∏î‡∏†‡∏≤‡∏©‡∏µ‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£", y2567: 943024422.16, y2568: 950000000.00, y2569: 1124589700.00, change: 18.4, changeColor: 'text-green-600', changeIcon: '‚ÜóÔ∏è' }
                    ],
                    total: { y2567: 943024422.16, y2568: 950000000.00, y2569: 1124589700.00, change: 18.4, changeColor: 'text-green-600', changeIcon: '‚ÜóÔ∏è' }
                },
                governmentSubsidy: {
                    title: "‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ê‡∏ö‡∏≤‡∏•‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô‡πÉ‡∏´‡πâ‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô",
                    items: [
                        { name: "‡∏´‡∏°‡∏ß‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô", y2567: 204458795.00, y2568: 255430100.00, y2569: 274865300.00, change: 7.6, changeColor: 'text-green-600', changeIcon: '‚ÜóÔ∏è' }
                    ],
                    total: { y2567: 204458795.00, y2568: 255430100.00, y2569: 274865300.00, change: 7.6, changeColor: 'text-green-600', changeIcon: '‚ÜóÔ∏è' }
                },
                total: { y2567: 1668454590.17, y2568: 1727118500.00, y2569: 1980000000.00, change: 14.6, changeColor: 'text-green-600', changeIcon: '‚ÜóÔ∏è' }
            },
            expense: {
                title: "2. ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢",
                budgetExpense: {
                    title: "‡∏à‡πà‡∏≤‡∏¢‡∏à‡∏≤‡∏Å‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì",
                    items: [
                        { name: "‡∏á‡∏ö‡∏Å‡∏•‡∏≤‡∏á", y2567: 48546702.62, y2568: 101014806.00, y2569: 154622789.00, change: 53.1, changeColor: 'text-green-600', changeIcon: '‚ÜóÔ∏è' },
                        { name: "‡∏á‡∏ö‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£", y2567: 287432746.54, y2568: 498129069.00, y2569: 523453780.00, change: 5.1, changeColor: 'text-green-600', changeIcon: '‚ÜóÔ∏è' },
                        { name: "‡∏á‡∏ö‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô", y2567: 507871342.30, y2568: 842367190.00, y2569: 961920254.00, change: 14.2, changeColor: 'text-green-600', changeIcon: '‚ÜóÔ∏è' },
                        { name: "‡∏á‡∏ö‡∏•‡∏á‡∏ó‡∏∏‡∏ô", y2567: 49988705.51, y2568: 173587710.00, y2569: 225761372.00, change: 30.1, changeColor: 'text-green-600', changeIcon: '‚ÜóÔ∏è' },
                        { name: "‡∏á‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô", y2567: 120206882.48, y2568: 112014725.00, y2569: 114236805.00, change: 2.0, changeColor: 'text-green-600', changeIcon: '‚ÜóÔ∏è' },
                        { name: "‡∏á‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏∑‡πà‡∏ô", y2567: 0.00, y2568: 5000.00, y2569: 5000.00, change: 0.0, changeColor: 'text-gray-600', changeIcon: '‚û°Ô∏è' }
                    ],
                    total: { y2567: 1014046379.45, y2568: 1727118500.00, y2569: 1980000000.00, change: 14.6, changeColor: 'text-green-600', changeIcon: '‚ÜóÔ∏è' }
                },
                total: { y2567: 1014046379.45, y2568: 1727118500.00, y2569: 1980000000.00, change: 14.6, changeColor: 'text-green-600', changeIcon: '‚ÜóÔ∏è' }
            }
        };

        // Optimized subsidy data with pre-computed values
        let subsidyData = {
            title: "‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô",
            budget2567: 292.3025, disbursed2567: 292.1109, percentDisbursed2567: 99.93, remaining2567: 0.1916,
            budget2568: 297.5705, disbursed2568: 297.5705, po2568: 297.5702, percentUsed2568: 99.99, remaining2568: 0.0003,
            budget2569: 329.5493, change2569: 31.9788, percentChange2569: 10.75,
            categories: [
                {
                    name: "1. ‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ",
                    budget2567: 254.3660, disbursed2567: 254.3660, percentDisbursed2567: 100.00, remaining2567: 0,
                    budget2568: 256.7105, disbursed2568: 256.7105, po2568: 256.7105, percentUsed2568: 100.00, remaining2568: 0,
                    budget2569: 274.8653, change2569: 18.1548, percentChange2569: 7.07,
                    subcategories: [
                        { name: "1) ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£", budget2567: 136.9095, disbursed2567: 136.9095, percentDisbursed2567: 100.00, remaining2567: 0, budget2568: 146.9321, disbursed2568: 146.9321, po2568: 146.9321, percentUsed2568: 100.00, remaining2568: 0, budget2569: 162.5643, change2569: 15.6322, percentChange2569: 10.64 },
                        { name: "2) ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô", budget2567: 70.7561, disbursed2567: 70.7561, percentDisbursed2567: 100.00, remaining2567: 0, budget2568: 71.4034, disbursed2568: 71.4034, po2568: 71.4034, percentUsed2568: 100.00, remaining2568: 0, budget2569: 84.0332, change2569: 12.6298, percentChange2569: 17.69 },
                        { name: "3) ‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏≠‡∏≥‡∏ô‡∏≤‡∏à‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ø", budget2567: 46.7004, disbursed2567: 46.7004, percentDisbursed2567: 100.00, remaining2567: 0, budget2568: 38.3750, disbursed2568: 38.3750, po2568: 38.3750, percentUsed2568: 100.00, remaining2568: 0, budget2569: 28.2678, change2569: -10.1072, percentChange2569: -26.34 }
                    ]
                },
                {
                    name: "2. ‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏¥‡∏à",
                    budget2567: 37.9365, disbursed2567: 37.7449, percentDisbursed2567: 99.49, remaining2567: 0.1916,
                    budget2568: 40.8600, disbursed2568: 0, po2568: 40.8597, percentUsed2568: 99.99, remaining2568: 0.0003,
                    budget2569: 54.6840, change2569: 13.8240, percentChange2569: 33.83,
                    subcategories: [
                        { name: "1) ‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå", budget2567: 37.9365, disbursed2567: 37.7449, percentDisbursed2567: 99.49, remaining2567: 0.1916, budget2568: 40.8600, disbursed2568: 0, po2568: 40.8597, percentUsed2568: 99.99, remaining2568: 0.0003, budget2569: 54.6840, change2569: 13.8240, percentChange2569: 33.83 }
                    ]
                }
            ]
        };

        // Fast utility functions
        const formatNumber = (num) => numberFormatter.format(num);
        const getChangeColor = (change) => change > 0 ? 'text-green-600' : change < 0 ? 'text-red-600' : 'text-gray-600';
        const getChangeIcon = (change) => change > 0 ? '‚ÜóÔ∏è' : change < 0 ? '‚ÜòÔ∏è' : '‚û°Ô∏è';

        // Generate revenue 2568 detailed table
        function generateRevenue2568Table() {
            if (loadedViews.has('revenue2568')) return;
            
            const tbody = document.getElementById('revenue2568TableBody');
            const fragments = [];
            
            let grandTotal = { estimated: 0, actual: 0, difference: 0 };

            revenue2568Data.forEach((categoryData, catIndex) => {
                // Category items
                categoryData.items.forEach((item, itemIndex) => {
                    const bgClass = (catIndex + itemIndex) % 2 === 0 ? 'bg-white' : 'bg-gray-50';
                    const stickyClass = (catIndex + itemIndex) % 2 === 0 ? 'sticky-cell sticky-cell-white' : 'sticky-cell sticky-cell-gray';
                    const differenceColor = item.difference >= 0 ? 'text-green-600' : 'text-red-600';
                    const differenceIcon = item.difference >= 0 ? '‚ÜóÔ∏è' : '‚ÜòÔ∏è';
                    
                    fragments.push(`<tr class="${bgClass} hover-row">
                        <td class="p-2 md:p-3 text-xs md:text-sm font-semibold ${stickyClass} md:static">${itemIndex === 0 ? categoryData.category : ''}</td>
                        <td class="p-2 md:p-3 text-xs md:text-sm">${item.type}</td>
                        <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(item.estimated)}</td>
                        <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(item.actual)}</td>
                        <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm ${differenceColor}">${differenceIcon} ${formatNumber(item.difference)}</td>
                    </tr>`);
                });

                // Category total
                const totalDifferenceColor = categoryData.total.difference >= 0 ? 'text-green-600' : 'text-red-600';
                const totalDifferenceIcon = categoryData.total.difference >= 0 ? '‚ÜóÔ∏è' : '‚ÜòÔ∏è';
                
                fragments.push(`<tr class="bg-blue-50 font-bold text-blue-800">
                    <td class="p-2 md:p-3 text-xs md:text-sm sticky-cell sticky-cell-blue md:static">‡∏£‡∏ß‡∏°${categoryData.category}</td>
                    <td class="p-2 md:p-3 text-xs md:text-sm"></td>
                    <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(categoryData.total.estimated)}</td>
                    <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(categoryData.total.actual)}</td>
                    <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm ${totalDifferenceColor}">${totalDifferenceIcon} ${formatNumber(categoryData.total.difference)}</td>
                </tr>`);

                // Add to grand total
                grandTotal.estimated += categoryData.total.estimated;
                grandTotal.actual += categoryData.total.actual;
                grandTotal.difference += categoryData.total.difference;
            });

            const grandDifferenceColor = grandTotal.difference >= 0 ? 'text-green-600' : 'text-red-600';
            const grandDifferenceIcon = grandTotal.difference >= 0 ? '‚ÜóÔ∏è' : '‚ÜòÔ∏è';
            
            fragments.push(`<tr class="bg-blue-200 font-bold text-blue-900">
                <td class="p-2 md:p-3 text-xs md:text-sm sticky-cell sticky-cell-blue md:static">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</td>
                <td class="p-2 md:p-3 text-xs md:text-sm"></td>
                <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(grandTotal.estimated)}</td>
                <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(grandTotal.actual)}</td>
                <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm ${grandDifferenceColor}">${grandDifferenceIcon} ${formatNumber(grandTotal.difference)}</td>
            </tr>`);

            tbody.innerHTML = fragments.join('');
            loadedViews.add('revenue2568');
        }

        // Generate revenue 2567 detailed table
        function generateRevenue2567Table() {
            if (loadedViews.has('revenue2567')) return;
            
            const tbody = document.getElementById('revenue2567TableBody');
            const fragments = [];
            
            let grandTotal = { estimated: 0, actual: 0, difference: 0 };

            revenue2567Data.forEach((categoryData, catIndex) => {
                // Category items
                categoryData.items.forEach((item, itemIndex) => {
                    const bgClass = (catIndex + itemIndex) % 2 === 0 ? 'bg-white' : 'bg-gray-50';
                    const stickyClass = (catIndex + itemIndex) % 2 === 0 ? 'sticky-cell sticky-cell-white' : 'sticky-cell sticky-cell-gray';
                    const differenceColor = item.difference >= 0 ? 'text-green-600' : 'text-red-600';
                    const differenceIcon = item.difference >= 0 ? '‚ÜóÔ∏è' : '‚ÜòÔ∏è';
                    
                    fragments.push(`<tr class="${bgClass} hover-row">
                        <td class="p-2 md:p-3 text-xs md:text-sm font-semibold ${stickyClass} md:static">${itemIndex === 0 ? categoryData.category : ''}</td>
                        <td class="p-2 md:p-3 text-xs md:text-sm">${item.type}</td>
                        <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(item.estimated)}</td>
                        <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(item.actual)}</td>
                        <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm ${differenceColor}">${differenceIcon} ${formatNumber(item.difference)}</td>
                    </tr>`);
                });

                // Category total
                const totalDifferenceColor = categoryData.total.difference >= 0 ? 'text-green-600' : 'text-red-600';
                const totalDifferenceIcon = categoryData.total.difference >= 0 ? '‚ÜóÔ∏è' : '‚ÜòÔ∏è';
                
                fragments.push(`<tr class="bg-blue-50 font-bold text-blue-800">
                    <td class="p-2 md:p-3 text-xs md:text-sm sticky-cell sticky-cell-blue md:static">‡∏£‡∏ß‡∏°${categoryData.category}</td>
                    <td class="p-2 md:p-3 text-xs md:text-sm"></td>
                    <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(categoryData.total.estimated)}</td>
                    <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(categoryData.total.actual)}</td>
                    <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm ${totalDifferenceColor}">${totalDifferenceIcon} ${formatNumber(categoryData.total.difference)}</td>
                </tr>`);

                // Add to grand total
                grandTotal.estimated += categoryData.total.estimated;
                grandTotal.actual += categoryData.total.actual;
                grandTotal.difference += categoryData.total.difference;
            });

            const grandDifferenceColor = grandTotal.difference >= 0 ? 'text-green-600' : 'text-red-600';
            const grandDifferenceIcon = grandTotal.difference >= 0 ? '‚ÜóÔ∏è' : '‚ÜòÔ∏è';
            
            fragments.push(`<tr class="bg-blue-200 font-bold text-blue-900">
                <td class="p-2 md:p-3 text-xs md:text-sm sticky-cell sticky-cell-blue md:static">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</td>
                <td class="p-2 md:p-3 text-xs md:text-sm"></td>
                <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(grandTotal.estimated)}</td>
                <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(grandTotal.actual)}</td>
                <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm ${grandDifferenceColor}">${grandDifferenceIcon} ${formatNumber(grandTotal.difference)}</td>
            </tr>`);

            tbody.innerHTML = fragments.join('');
            loadedViews.add('revenue2567');
        }

        // Optimized revenue table generation
        function generateRevenueTable() {
            if (loadedViews.has('revenue')) return;
            
            const tbody = document.getElementById('revenueTableBody');
            const fragments = [];

            // Self Revenue Section
            fragments.push(`<tr class="bg-gray-100 font-bold text-gray-800">
                <td colspan="5" class="p-2 md:p-3 text-xs md:text-sm sticky-cell sticky-cell-gray md:static">${budgetData.revenue.selfRevenue.title}</td>
            </tr>`);

            budgetData.revenue.selfRevenue.items.forEach((item, index) => {
                const bgClass = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';
                const stickyClass = index % 2 === 0 ? 'sticky-cell sticky-cell-white' : 'sticky-cell sticky-cell-gray';
                fragments.push(`<tr class="${bgClass} hover-row">
                    <td class="p-2 md:p-3 text-xs md:text-sm ${stickyClass} md:static">${item.name}</td>
                    <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(item.y2567)}</td>
                    <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(item.y2568)}</td>
                    <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(item.y2569)}</td>
                    <td class="p-2 md:p-3 text-center ${item.changeColor} text-xs md:text-sm">${item.changeIcon} ${item.change}%</td>
                </tr>`);
            });

            fragments.push(`<tr class="bg-blue-50 font-bold text-blue-800">
                <td class="p-2 md:p-3 text-xs md:text-sm sticky-cell sticky-cell-blue md:static">‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏≠‡∏á</td>
                <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(budgetData.revenue.selfRevenue.total.y2567)}</td>
                <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(budgetData.revenue.selfRevenue.total.y2568)}</td>
                <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(budgetData.revenue.selfRevenue.total.y2569)}</td>
                <td class="p-2 md:p-3 text-center ${budgetData.revenue.selfRevenue.total.changeColor} text-xs md:text-sm">${budgetData.revenue.selfRevenue.total.changeIcon} ${budgetData.revenue.selfRevenue.total.change}%</td>
            </tr>`);

            // Government Allocation Section
            fragments.push(`<tr class="bg-gray-100 font-bold text-gray-800">
                <td colspan="5" class="p-2 md:p-3 text-xs md:text-sm sticky-cell sticky-cell-gray md:static">${budgetData.revenue.governmentAllocation.title}</td>
            </tr>`);

            budgetData.revenue.governmentAllocation.items.forEach((item) => {
                fragments.push(`<tr class="bg-white hover-row">
                    <td class="p-2 md:p-3 text-xs md:text-sm sticky-cell sticky-cell-white md:static">${item.name}</td>
                    <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(item.y2567)}</td>
                    <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(item.y2568)}</td>
                    <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(item.y2569)}</td>
                    <td class="p-2 md:p-3 text-center ${item.changeColor} text-xs md:text-sm">${item.changeIcon} ${item.change}%</td>
                </tr>`);
            });

            fragments.push(`<tr class="bg-blue-50 font-bold text-blue-800">
                <td class="p-2 md:p-3 text-xs md:text-sm sticky-cell sticky-cell-blue md:static">‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ê‡∏ö‡∏≤‡∏•‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£</td>
                <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(budgetData.revenue.governmentAllocation.total.y2567)}</td>
                <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(budgetData.revenue.governmentAllocation.total.y2568)}</td>
                <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(budgetData.revenue.governmentAllocation.total.y2569)}</td>
                <td class="p-2 md:p-3 text-center ${budgetData.revenue.governmentAllocation.total.changeColor} text-xs md:text-sm">${budgetData.revenue.governmentAllocation.total.changeIcon} ${budgetData.revenue.governmentAllocation.total.change}%</td>
            </tr>`);

            // Government Subsidy Section
            fragments.push(`<tr class="bg-gray-100 font-bold text-gray-800">
                <td colspan="5" class="p-2 md:p-3 text-xs md:text-sm sticky-cell sticky-cell-gray md:static">${budgetData.revenue.governmentSubsidy.title}</td>
            </tr>`);

            budgetData.revenue.governmentSubsidy.items.forEach((item) => {
                fragments.push(`<tr class="bg-white hover-row">
                    <td class="p-2 md:p-3 text-xs md:text-sm sticky-cell sticky-cell-white md:static">${item.name}</td>
                    <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(item.y2567)}</td>
                    <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(item.y2568)}</td>
                    <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(item.y2569)}</td>
                    <td class="p-2 md:p-3 text-center ${item.changeColor} text-xs md:text-sm">${item.changeIcon} ${item.change}%</td>
                </tr>`);
            });

            fragments.push(`<tr class="bg-blue-50 font-bold text-blue-800">
                <td class="p-2 md:p-3 text-xs md:text-sm sticky-cell sticky-cell-blue md:static">‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ê‡∏ö‡∏≤‡∏•‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô</td>
                <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(budgetData.revenue.governmentSubsidy.total.y2567)}</td>
                <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(budgetData.revenue.governmentSubsidy.total.y2568)}</td>
                <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(budgetData.revenue.governmentSubsidy.total.y2569)}</td>
                <td class="p-2 md:p-3 text-center ${budgetData.revenue.governmentSubsidy.total.changeColor} text-xs md:text-sm">${budgetData.revenue.governmentSubsidy.total.changeIcon} ${budgetData.revenue.governmentSubsidy.total.change}%</td>
            </tr>`);

            // Revenue Total
            fragments.push(`<tr class="bg-blue-200 font-bold text-blue-900">
                <td class="p-2 md:p-3 text-xs md:text-sm sticky-cell sticky-cell-blue md:static">‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</td>
                <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(budgetData.revenue.total.y2567)}</td>
                <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(budgetData.revenue.total.y2568)}</td>
                <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(budgetData.revenue.total.y2569)}</td>
                <td class="p-2 md:p-3 text-center ${budgetData.revenue.total.changeColor} text-xs md:text-sm">${budgetData.revenue.total.changeIcon} ${budgetData.revenue.total.change}%</td>
            </tr>`);

            tbody.innerHTML = fragments.join('');
            loadedViews.add('revenue');
        }

        // Optimized expense table generation
        function generateExpenseTable() {
            if (loadedViews.has('expense')) return;
            
            const tbody = document.getElementById('expenseTableBody');
            const fragments = [];

            // Budget Expense Section
            fragments.push(`<tr class="bg-gray-100 font-bold text-gray-800">
                <td colspan="5" class="p-2 md:p-3 text-xs md:text-sm sticky-cell sticky-cell-gray md:static">${budgetData.expense.budgetExpense.title}</td>
            </tr>`);

            budgetData.expense.budgetExpense.items.forEach((item, index) => {
                const bgClass = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';
                const stickyClass = index % 2 === 0 ? 'sticky-cell sticky-cell-white' : 'sticky-cell sticky-cell-gray';
                fragments.push(`<tr class="${bgClass} hover-row">
                    <td class="p-2 md:p-3 text-xs md:text-sm ${stickyClass} md:static">${item.name}</td>
                    <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(item.y2567)}</td>
                    <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(item.y2568)}</td>
                    <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(item.y2569)}</td>
                    <td class="p-2 md:p-3 text-center ${item.changeColor} text-xs md:text-sm">${item.changeIcon} ${item.change}%</td>
                </tr>`);
            });

            fragments.push(`<tr class="bg-blue-100 font-bold text-blue-800">
                <td class="p-2 md:p-3 text-xs md:text-sm sticky-cell sticky-cell-blue md:static">‡∏£‡∏ß‡∏°‡∏à‡πà‡∏≤‡∏¢‡∏à‡∏≤‡∏Å‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</td>
                <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(budgetData.expense.budgetExpense.total.y2567)}</td>
                <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(budgetData.expense.budgetExpense.total.y2568)}</td>
                <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(budgetData.expense.budgetExpense.total.y2569)}</td>
                <td class="p-2 md:p-3 text-center ${budgetData.expense.budgetExpense.total.changeColor} text-xs md:text-sm">${budgetData.expense.budgetExpense.total.changeIcon} ${budgetData.expense.budgetExpense.total.change}%</td>
            </tr>`);

            // Expense Total
            fragments.push(`<tr class="bg-blue-200 font-bold text-blue-900">
                <td class="p-2 md:p-3 text-xs md:text-sm sticky-cell sticky-cell-blue md:static">‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</td>
                <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(budgetData.expense.total.y2567)}</td>
                <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(budgetData.expense.total.y2568)}</td>
                <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${formatNumber(budgetData.expense.total.y2569)}</td>
                <td class="p-2 md:p-3 text-center ${budgetData.expense.total.changeColor} text-xs md:text-sm">${budgetData.expense.total.changeIcon} ${budgetData.expense.total.change}%</td>
            </tr>`);

            tbody.innerHTML = fragments.join('');
            loadedViews.add('expense');
        }

        // Optimized subsidy table generation
        function generateSubsidyTable() {
            if (loadedViews.has('subsidy')) return;
            
            const tbody = document.getElementById('subsidyTableBody');
            const fragments = [];

            // Main title row
            const mainChange = subsidyData.change2569 >= 0 ? `+${subsidyData.change2569}` : subsidyData.change2569;
            const mainPercentChange = subsidyData.percentChange2569 >= 0 ? `+${subsidyData.percentChange2569}` : subsidyData.percentChange2569;
            
            fragments.push(`<tr class="bg-blue-200 font-bold text-blue-900">
                <td class="p-2 md:p-3 text-xs md:text-sm sticky left-0 bg-blue-200 z-5 min-w-[250px] md:min-w-0 md:static">${subsidyData.title}</td>
                <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${subsidyData.budget2567.toFixed(4)}</td>
                <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${subsidyData.disbursed2567.toFixed(4)}</td>
                <td class="p-2 md:p-3 text-center text-xs md:text-sm">${subsidyData.percentDisbursed2567.toFixed(2)}</td>
                <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${subsidyData.remaining2567.toFixed(4)}</td>
                <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${subsidyData.budget2568.toFixed(4)}</td>
                <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${subsidyData.disbursed2568.toFixed(4)}</td>
                <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${subsidyData.po2568.toFixed(4)}</td>
                <td class="p-2 md:p-3 text-center text-xs md:text-sm">${subsidyData.percentUsed2568.toFixed(2)}</td>
                <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${subsidyData.remaining2568.toFixed(4)}</td>
                <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${subsidyData.budget2569.toFixed(4)}</td>
                <td class="p-2 md:p-3 text-center ${subsidyData.change2569 >= 0 ? 'text-green-600' : 'text-red-600'} text-xs md:text-sm">${mainChange}</td>
                <td class="p-2 md:p-3 text-center ${subsidyData.percentChange2569 >= 0 ? 'text-green-600' : 'text-red-600'} text-xs md:text-sm">${mainPercentChange}</td>
            </tr>`);

            // Categories
            subsidyData.categories.forEach((category, catIndex) => {
                const catChange = category.change2569 >= 0 ? `+${category.change2569}` : category.change2569;
                const catPercentChange = category.percentChange2569 >= 0 ? `+${category.percentChange2569}` : category.percentChange2569;
                const bgClass = catIndex % 2 === 0 ? 'bg-white' : 'bg-gray-50';
                const stickyClass = catIndex % 2 === 0 ? 'sticky-cell sticky-cell-white' : 'sticky-cell sticky-cell-gray';
                
                fragments.push(`<tr class="bg-blue-50 font-bold text-blue-800 hover-row">
                    <td class="p-2 md:p-3 text-xs md:text-sm sticky left-0 bg-blue-50 z-5 min-w-[250px] md:min-w-0 md:static">${category.name}</td>
                    <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${category.budget2567.toFixed(4)}</td>
                    <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${category.disbursed2567.toFixed(4)}</td>
                    <td class="p-2 md:p-3 text-center text-xs md:text-sm">${category.percentDisbursed2567.toFixed(2)}</td>
                    <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${category.remaining2567 === 0 ? '-' : category.remaining2567.toFixed(4)}</td>
                    <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${category.budget2568.toFixed(4)}</td>
                    <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${category.disbursed2568 === 0 ? '-' : category.disbursed2568.toFixed(4)}</td>
                    <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${category.po2568.toFixed(4)}</td>
                    <td class="p-2 md:p-3 text-center text-xs md:text-sm">${category.percentUsed2568.toFixed(2)}</td>
                    <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${category.remaining2568 === 0 ? '-' : category.remaining2568.toFixed(4)}</td>
                    <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${category.budget2569.toFixed(4)}</td>
                    <td class="p-2 md:p-3 text-center ${category.change2569 >= 0 ? 'text-green-600' : 'text-red-600'} text-xs md:text-sm">${catChange}</td>
                    <td class="p-2 md:p-3 text-center ${category.percentChange2569 >= 0 ? 'text-green-600' : 'text-red-600'} text-xs md:text-sm">${catPercentChange}</td>
                </tr>`);

                // Subcategories
                if (category.subcategories) {
                    category.subcategories.forEach((sub, subIndex) => {
                        const subChange = sub.change2569 >= 0 ? `+${sub.change2569}` : sub.change2569;
                        const subPercentChange = sub.percentChange2569 >= 0 ? `+${sub.percentChange2569}` : sub.percentChange2569;
                        const subBgClass = (catIndex + subIndex) % 2 === 0 ? 'bg-gray-50' : 'bg-white';
                        const subStickyClass = (catIndex + subIndex) % 2 === 0 ? 'sticky-cell sticky-cell-gray' : 'sticky-cell sticky-cell-white';
                        
                        fragments.push(`<tr class="${subBgClass} hover-row">
                            <td class="p-2 md:p-3 text-xs md:text-sm pl-6 ${subStickyClass} md:static">${sub.name}</td>
                            <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${sub.budget2567.toFixed(4)}</td>
                            <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${sub.disbursed2567.toFixed(4)}</td>
                            <td class="p-2 md:p-3 text-center text-xs md:text-sm">${sub.percentDisbursed2567.toFixed(2)}</td>
                            <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${sub.remaining2567 === 0 ? '-' : sub.remaining2567.toFixed(4)}</td>
                            <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${sub.budget2568.toFixed(4)}</td>
                            <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${sub.disbursed2568 === 0 ? '-' : sub.disbursed2568.toFixed(4)}</td>
                            <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${sub.po2568.toFixed(4)}</td>
                            <td class="p-2 md:p-3 text-center text-xs md:text-sm">${sub.percentUsed2568.toFixed(2)}</td>
                            <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${sub.remaining2568 === 0 ? '-' : sub.remaining2568.toFixed(4)}</td>
                            <td class="p-2 md:p-3 text-right number-cell text-xs md:text-sm">${sub.budget2569.toFixed(4)}</td>
                            <td class="p-2 md:p-3 text-center ${sub.change2569 >= 0 ? 'text-green-600' : 'text-red-600'} text-xs md:text-sm">${subChange}</td>
                            <td class="p-2 md:p-3 text-center ${sub.percentChange2569 >= 0 ? 'text-green-600' : 'text-red-600'} text-xs md:text-sm">${subPercentChange}</td>
                        </tr>`);
                    });
                }
            });

            tbody.innerHTML = fragments.join('');
            loadedViews.add('subsidy');
        }

        // Generate subsidy charts
        function generateSubsidyCharts() {
            const container = document.getElementById('subsidyChartContent');
            let html = '';

            // Budget comparison across years
            html += `<div class="mb-6 md:mb-8">
                <h4 class="text-lg font-semibold mb-4">‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô</h4>
                <div class="space-y-3 md:space-y-4">`;

            const yearData = [
                { year: '‡∏õ‡∏µ 2567', budget: subsidyData.budget2567, color: 'bg-red-400' },
                { year: '‡∏õ‡∏µ 2568', budget: subsidyData.budget2568, color: 'bg-yellow-400' },
                { year: '‡∏õ‡∏µ 2569', budget: subsidyData.budget2569, color: 'bg-green-400' }
            ];

            const maxBudget = Math.max(...yearData.map(d => d.budget));

            yearData.forEach(item => {
                const percentage = (item.budget / maxBudget) * 100;
                html += `<div class="flex flex-col md:flex-row md:items-center">
                    <div class="w-full md:w-24 text-sm font-medium mb-2 md:mb-0">${item.year}</div>
                    <div class="flex-1 bg-gray-200 rounded-full h-6 md:h-8 md:mx-4">
                        <div class="chart-bar ${item.color} h-6 md:h-8 rounded-full flex items-center justify-end pr-2" 
                             style="width: ${percentage}%">
                            <span class="text-white text-xs font-bold hidden md:inline">${item.budget.toFixed(4)} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó</span>
                        </div>
                    </div>
                    <div class="text-xs md:text-sm text-gray-600 mt-1 md:mt-0 md:w-20">${item.budget.toFixed(4)} ‡∏•‡πâ‡∏≤‡∏ô</div>
                </div>`;
            });

            html += `</div></div>`;

            // Category breakdown for 2569
            html += `<div class="mb-6 md:mb-8">
                <h4 class="text-lg font-semibold mb-4">‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô ‡∏õ‡∏µ 2569</h4>
                <div class="space-y-3 md:space-y-4">`;

            const categoryData = subsidyData.categories.map((cat, index) => ({
                name: cat.name,
                budget: cat.budget2569,
                color: ['bg-sky-300', 'bg-cyan-300'][index]
            }));

            categoryData.forEach(cat => {
                const percentage = (cat.budget / subsidyData.budget2569) * 100;
                html += `<div class="flex flex-col md:flex-row md:items-center">
                    <div class="w-full md:w-48 text-sm font-medium mb-2 md:mb-0">${cat.name}</div>
                    <div class="flex-1 bg-gray-200 rounded-full h-6 md:h-8 md:mx-4 relative">
                        <div class="chart-bar ${cat.color} h-6 md:h-8 rounded-full" 
                             style="width: ${percentage}%">
                        </div>
                        <div class="absolute right-0 top-0 h-6 md:h-8 flex items-center pr-2">
                            <span class="text-xs md:text-sm font-bold text-gray-700">${cat.budget.toFixed(4)} ‡∏•‡πâ‡∏≤‡∏ô</span>
                        </div>
                    </div>
                    <div class="text-xs md:text-sm text-gray-600 mt-1 md:mt-0 md:w-16 md:ml-2">${percentage.toFixed(1)}%</div>
                </div>`;
            });

            html += `</div></div>`;

            // Change analysis
            html += `<div class="mb-6 md:mb-8">
                <h4 class="text-lg font-semibold mb-4">‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì (2568 ‚Üí 2569)</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">`;

            subsidyData.categories.forEach(cat => {
                const changeColor = cat.change2569 >= 0 ? 'text-green-600' : 'text-red-600';
                const changeBg = cat.change2569 >= 0 ? 'bg-green-50' : 'bg-red-50';
                const changeIcon = cat.change2569 >= 0 ? 'üìà' : 'üìâ';
                
                html += `<div class="${changeBg} p-3 md:p-4 rounded-lg">
                    <h5 class="font-semibold mb-2">${changeIcon} ${cat.name}</h5>
                    <div class="space-y-1 text-sm">
                        <div class="flex justify-between">
                            <span>‡∏õ‡∏µ 2568:</span>
                            <span>${cat.budget2568.toFixed(4)} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó</span>
                        </div>
                        <div class="flex justify-between">
                            <span>‡∏õ‡∏µ 2569:</span>
                            <span>${cat.budget2569.toFixed(4)} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó</span>
                        </div>
                        <div class="flex justify-between font-semibold ${changeColor}">
                            <span>‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á:</span>
                            <span>${cat.change2569 >= 0 ? '+' : ''}${cat.change2569.toFixed(4)} ‡∏•‡πâ‡∏≤‡∏ô (${cat.percentChange2569 >= 0 ? '+' : ''}${cat.percentChange2569.toFixed(2)}%)</span>
                        </div>
                    </div>
                </div>`;
            });

            html += `</div></div>`;

            container.innerHTML = html;
        }

        // Optimized chart generation
        function generateCharts() {
            if (loadedViews.has('charts')) return;
            
            const container = document.getElementById('chartContent');
            const fragments = [];

            // Pre-computed values for better performance
            const maxValue = Math.max(budgetData.revenue.total.y2569, budgetData.expense.total.y2569);
            const maxRevenue = budgetData.revenue.total.y2569;
            const maxExpense = budgetData.expense.total.y2569;

            // Summary section
            fragments.push(`<div class="mb-6 md:mb-8">
                <h3 class="text-lg md:text-xl font-semibold mb-4">‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö - ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
                    <div class="bg-blue-50 p-3 md:p-4 rounded-lg">
                        <h4 class="font-semibold text-blue-800 mb-3">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</h4>
                        <div class="space-y-2">
                            <div class="flex justify-between text-xs md:text-sm">
                                <span>‡∏õ‡∏µ 2567 (‡∏à‡∏£‡∏¥‡∏á)</span>
                                <span class="font-bold text-blue-600">${formatNumber(budgetData.revenue.total.y2567)}</span>
                            </div>
                            <div class="flex justify-between text-xs md:text-sm">
                                <span>‡∏õ‡∏µ 2568 (‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£)</span>
                                <span class="font-bold text-blue-600">${formatNumber(budgetData.revenue.total.y2568)}</span>
                            </div>
                            <div class="flex justify-between text-xs md:text-sm">
                                <span>‡∏õ‡∏µ 2569 (‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£)</span>
                                <span class="font-bold text-blue-600">${formatNumber(budgetData.revenue.total.y2569)}</span>
                            </div>
                            <div class="border-t pt-2 text-center">
                                <span class="text-xs md:text-sm font-semibold">‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á (2568‚Üí2569): ${budgetData.revenue.total.changeIcon} ${budgetData.revenue.total.change}%</span>
                            </div>
                        </div>
                    </div>
                    <div class="bg-indigo-50 p-3 md:p-4 rounded-lg">
                        <h4 class="font-semibold text-indigo-800 mb-3">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h4>
                        <div class="space-y-2">
                            <div class="flex justify-between text-xs md:text-sm">
                                <span>‡∏õ‡∏µ 2567 (‡∏à‡∏£‡∏¥‡∏á)</span>
                                <span class="font-bold text-indigo-600">${formatNumber(budgetData.expense.total.y2567)}</span>
                            </div>
                            <div class="flex justify-between text-xs md:text-sm">
                                <span>‡∏õ‡∏µ 2568 (‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£)</span>
                                <span class="font-bold text-indigo-600">${formatNumber(budgetData.expense.total.y2568)}</span>
                            </div>
                            <div class="flex justify-between text-xs md:text-sm">
                                <span>‡∏õ‡∏µ 2569 (‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£)</span>
                                <span class="font-bold text-indigo-600">${formatNumber(budgetData.expense.total.y2569)}</span>
                            </div>
                            <div class="border-t pt-2 text-center">
                                <span class="text-xs md:text-sm font-semibold">‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á (2568‚Üí2569): ${budgetData.expense.total.changeIcon} ${budgetData.expense.total.change}%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>`);

            // Revenue vs Expense comparison
            const revenueExpense = [
                { name: '‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏ß‡∏°', value: budgetData.revenue.total.y2569, color: 'bg-blue-400', percentage: (budgetData.revenue.total.y2569 / maxValue) * 100 },
                { name: '‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°', value: budgetData.expense.total.y2569, color: 'bg-indigo-400', percentage: (budgetData.expense.total.y2569 / maxValue) * 100 }
            ];

            fragments.push(`<div class="mb-6 md:mb-8">
                <h3 class="text-lg md:text-xl font-semibold mb-4">‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö vs ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ (‡∏õ‡∏µ 2569)</h3>
                <div class="space-y-3 md:space-y-4">`);

            revenueExpense.forEach(item => {
                fragments.push(`<div class="flex flex-col md:flex-row md:items-center">
                    <div class="w-full md:w-32 text-sm font-medium mb-2 md:mb-0">${item.name}</div>
                    <div class="flex-1 bg-gray-200 rounded-full h-6 md:h-8 md:mx-4">
                        <div class="chart-bar ${item.color} h-6 md:h-8 rounded-full flex items-center justify-end pr-2" 
                             style="width: ${item.percentage}%">
                            <span class="text-white text-xs font-bold hidden md:inline">${formatNumber(item.value)}</span>
                        </div>
                    </div>
                    <div class="text-xs md:text-sm text-gray-600 mt-1 md:mt-0 md:w-16">${item.percentage.toFixed(1)}%</div>
                    <div class="text-xs text-gray-600 md:hidden">${formatNumber(item.value)} ‡∏ö‡∏≤‡∏ó</div>
                </div>`);
            });

            fragments.push(`</div></div>`);

            // Revenue breakdown
            const revenueCategories = [
                { name: '‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏≠‡∏á', value: budgetData.revenue.selfRevenue.total.y2569, color: 'bg-blue-300', percentage: (budgetData.revenue.selfRevenue.total.y2569 / maxRevenue) * 100 },
                { name: '‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ê‡∏ö‡∏≤‡∏•‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£', value: budgetData.revenue.governmentAllocation.total.y2569, color: 'bg-sky-300', percentage: (budgetData.revenue.governmentAllocation.total.y2569 / maxRevenue) * 100 },
                { name: '‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ê‡∏ö‡∏≤‡∏•‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô', value: budgetData.revenue.governmentSubsidy.total.y2569, color: 'bg-cyan-300', percentage: (budgetData.revenue.governmentSubsidy.total.y2569 / maxRevenue) * 100 }
            ];

            fragments.push(`<div class="mb-6 md:mb-8">
                <h3 class="text-lg md:text-xl font-semibold mb-4">‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö (‡∏õ‡∏µ 2569)</h3>
                <div class="space-y-3 md:space-y-4">`);

            revenueCategories.forEach(cat => {
                fragments.push(`<div class="flex flex-col md:flex-row md:items-center">
                    <div class="w-full md:w-48 text-sm font-medium mb-2 md:mb-0">${cat.name}</div>
                    <div class="flex-1 bg-gray-200 rounded-full h-6 md:h-8 md:mx-4 relative">
                        <div class="chart-bar ${cat.color} h-6 md:h-8 rounded-full" style="width: ${cat.percentage}%"></div>
                        <div class="absolute right-0 top-0 h-6 md:h-8 flex items-center pr-2">
                            <span class="text-xs md:text-sm font-bold text-gray-700">${formatNumber(cat.value)}</span>
                        </div>
                    </div>
                    <div class="text-xs md:text-sm text-gray-600 mt-1 md:mt-0 md:w-16 md:ml-2">${cat.percentage.toFixed(1)}%</div>
                </div>`);
            });

            fragments.push(`</div></div>`);

            // Expense breakdown
            const expenseCategories = budgetData.expense.budgetExpense.items.map((item, index) => ({
                name: item.name,
                value: item.y2569,
                color: ['bg-indigo-200', 'bg-indigo-300', 'bg-indigo-400', 'bg-indigo-500', 'bg-indigo-600', 'bg-indigo-700'][index],
                percentage: (item.y2569 / maxExpense) * 100
            }));

            fragments.push(`<div class="mb-6 md:mb-8">
                <h3 class="text-lg md:text-xl font-semibold mb-4">‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ (‡∏õ‡∏µ 2569)</h3>
                <div class="space-y-3 md:space-y-4">`);

            expenseCategories.forEach(cat => {
                fragments.push(`<div class="flex flex-col md:flex-row md:items-center">
                    <div class="w-full md:w-32 text-sm font-medium mb-2 md:mb-0">${cat.name}</div>
                    <div class="flex-1 bg-gray-200 rounded-full h-6 md:h-8 md:mx-4 relative">
                        <div class="chart-bar ${cat.color} h-6 md:h-8 rounded-full" style="width: ${cat.percentage}%"></div>
                        <div class="absolute right-0 top-0 h-6 md:h-8 flex items-center pr-2">
                            <span class="text-xs md:text-sm font-bold text-gray-700">${formatNumber(cat.value)}</span>
                        </div>
                    </div>
                    <div class="text-xs md:text-sm text-gray-600 mt-1 md:mt-0 md:w-16 md:ml-2">${cat.percentage.toFixed(1)}%</div>
                </div>`);
            });

            fragments.push(`</div></div>`);

            container.innerHTML = fragments.join('');
            loadedViews.add('charts');
        }

        // Optimized view switching with lazy loading
        function switchView(view) {
            if (isLoading) return;
            isLoading = true;

            // Use requestAnimationFrame for smooth transitions
            requestAnimationFrame(() => {
                // Hide all containers
                const containers = ['tableContainer', 'chartContainer', 'subsidyContainer'];
                containers.forEach(id => document.getElementById(id).classList.add('hidden'));

                // Reset button styles (cached selectors)
                const buttons = document.querySelectorAll('button[id$="View"]');
                const inactiveClass = 'px-3 py-2 md:px-4 md:py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors text-sm shadow-md';
                const activeClass = 'px-3 py-2 md:px-4 md:py-2 bg-blue-400 text-white rounded-lg hover:bg-blue-500 transition-colors text-sm shadow-md';
                
                buttons.forEach(btn => btn.className = inactiveClass);

                // Show selected view and highlight button
                if (view === 'table') {
                    document.getElementById('tableContainer').classList.remove('hidden');
                    document.getElementById('tableView').className = activeClass;
                } else if (view === 'chart') {
                    document.getElementById('chartContainer').classList.remove('hidden');
                    document.getElementById('chartView').className = activeClass;
                    generateCharts();
                } else if (view === 'subsidy') {
                    document.getElementById('subsidyContainer').classList.remove('hidden');
                    document.getElementById('subsidyView').className = activeClass;
                    generateSubsidyCharts();
                }

                isLoading = false;
            });
        }

        // Revenue tab switching
        function switchRevenueTab(tab) {
            // Hide all revenue content
            const revenueContents = document.querySelectorAll('.revenue-content');
            revenueContents.forEach(content => content.classList.add('hidden'));
            
            // Reset all revenue tab buttons
            const revenueButtons = ['revenueOverview', 'revenue2567', 'revenue2568'];
            revenueButtons.forEach(buttonId => {
                const button = document.getElementById(buttonId);
                button.className = 'px-3 py-2 text-sm font-medium text-gray-600 hover:text-blue-600 hover:bg-gray-50 border-b-2 border-transparent hover:border-blue-300 transition-colors';
            });
            
            // Show selected content and highlight button
            if (tab === 'overview') {
                document.getElementById('revenueOverviewContent').classList.remove('hidden');
                document.getElementById('revenueOverview').className = 'px-3 py-2 text-sm font-medium text-blue-600 bg-blue-50 border-b-2 border-blue-600 hover:bg-blue-100 transition-colors';
            } else if (tab === '2567') {
                document.getElementById('revenue2567Content').classList.remove('hidden');
                document.getElementById('revenue2567').className = 'px-3 py-2 text-sm font-medium text-blue-600 bg-blue-50 border-b-2 border-blue-600 hover:bg-blue-100 transition-colors';
                generateRevenue2567Table();
            } else if (tab === '2568') {
                document.getElementById('revenue2568Content').classList.remove('hidden');
                document.getElementById('revenue2568').className = 'px-3 py-2 text-sm font-medium text-blue-600 bg-blue-50 border-b-2 border-blue-600 hover:bg-blue-100 transition-colors';
                generateRevenue2568Table();
            }
        }

        // Fast initialization with lazy loading
        function initializeApp() {
            // Only generate visible content initially
            generateRevenueTable();
            generateExpenseTable();
            
            // Add event listeners with passive option for better performance
            document.getElementById('tableView').addEventListener('click', () => switchView('table'), { passive: true });
            document.getElementById('chartView').addEventListener('click', () => switchView('chart'), { passive: true });
            document.getElementById('subsidyView').addEventListener('click', () => switchView('subsidy'), { passive: true });
            
            // Add revenue tab event listeners
            document.getElementById('revenueOverview').addEventListener('click', () => switchRevenueTab('overview'), { passive: true });
            document.getElementById('revenue2567').addEventListener('click', () => switchRevenueTab('2567'), { passive: true });
            document.getElementById('revenue2568').addEventListener('click', () => switchRevenueTab('2568'), { passive: true });
            
            // Pre-generate subsidy table in next tick to avoid blocking
            setTimeout(() => {
                generateSubsidyTable();
            }, 0);
        }

        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
    </script>
</body>
</html>
